'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=wiki;var _util=require('./util'),_page=require('./page'),_page2=_interopRequireDefault(_page),_chain=require('./chain'),_chain2=_interopRequireDefault(_chain);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var defaultOptions={apiUrl:'http://en.wikipedia.org/w/api.php',origin:'*'};function wiki(){function a(r){return r.query.redirects&&1===r.query.redirects.length?(0,_util.api)(q,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',titles:r.query.redirects[0].to}):r}function b(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50,t=2<arguments.length&&arguments[2]!==void 0&&arguments[2];return(0,_util.pagination)(q,{list:'search',srsearch:r,srlimit:s},function(u){return u.query.search.map(function(v){return t?v:v.title})}).catch(function(u){if('"text" search is disabled.'===u.message)return d(r,s);throw u})}function d(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50;return(0,_util.api)(q,{search:r,limit:s,namespace:0,action:'opensearch',redirects:void 0}).then(function(t){return t[1]})}function f(r){return(0,_util.api)(q,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',titles:r}).then(a).then(function(s){var t=Object.keys(s.query.pages)[0];if(!t||'-1'===t)throw new Error('No article found');return(0,_page2.default)(s.query.pages[t],q)})}var p=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};this instanceof wiki&&console.log('Please do not use wikijs ^1.0.0 as a class. Please see the new README.');var q=Object.assign({},defaultOptions,p);return{search:b,random:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return(0,_util.api)(q,{list:'random',rnnamespace:0,rnlimit:r}).then(function(s){return s.query.random.map(function(t){return t.title})})},page:f,geoSearch:function(r,s){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1e3,u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:10;return(0,_util.api)(q,{list:'geosearch',gsradius:t,gscoord:r+'|'+s,gslimit:u}).then(function(v){return v.query.geosearch.map(function(w){return w.title})})},options:p,findById:function(r){return(0,_util.api)(q,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',pageids:r}).then(a).then(function(s){var t=Object.keys(s.query.pages)[0];if(!t||'-1'===t)throw new Error('No article found');return(0,_page2.default)(s.query.pages[t],q)})},find:function(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(t){return t[0]};return b(r).then(function(t){return s(t.results)}).then(function(t){return f(t)})},allPages:function(){return(0,_util.aggregate)(q,{},'allpages','title','ap')},allCategories:function(){return(0,_util.aggregate)(q,{},'allcategories','*','ac')},pagesInCategory:function(r){return(0,_util.aggregate)(q,{cmtitle:r},'categorymembers','title','cm')},opensearch:d,prefixSearch:function(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50;return(0,_util.pagination)(q,{list:'prefixsearch',pslimit:s,psprofile:'fuzzy',pssearch:r},function(t){return t.query.prefixsearch.map(function(u){return u.title})})},mostViewed:function(){return(0,_util.api)(q,{list:'mostviewed'}).then(function(r){return r.query.mostviewed.map(function(s){var t=s.title,u=s.count;return{title:t,count:u}})})},api:function(r){return(0,_util.api)(q,r)},chain:function(){return new _chain2.default(q)}}}
//# sourceMappingURL=wiki.js.map