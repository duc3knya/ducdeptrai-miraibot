'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_util=require('./util');function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var processors={extracts:function extracts(a){return{extract:a.extract}},links:function links(a){return{links:a.links.map(function(b){return b.title})}},extlinks:function extlinks(a){return{extlinks:a.extlinks.map(function(b){return b['*']})}},langlinks:function langlinks(a){return{langlinks:a.langlinks.map(function(b){return{lang:b.lang,title:b['*'],url:b.url}})}},coordinates:function coordinates(a){return a.coordinates?{coordinates:a.coordinates[0]}:{}},categories:function categories(a){return{categories:a.categories.map(function(b){return b.title})}},pageimages:function pageimages(a){return{image:{name:a.pageimage,thumbnail:a.thumbnail,original:a.original}}}};function process(a,b){var c={title:b.title};return a.reduce(function(d,f){return processors[f]&&Object.assign(d,processors[f](b)),d},c)}var QueryChain=function(){function a(b,c){_classCallCheck(this,a),this.id=c,this.apiOptions=b,this._params={pageids:c},this.props=new Set}return _createClass(a,[{key:'params',value:function params(){var b=[].concat(_toConsumableArray(this.props)).join('|');return Object.assign({},this._params,{prop:b})}},{key:'direct',value:function direct(b){for(var c=arguments.length,d=Array(1<c?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];return this[b].apply(this,d).request().then(function(g){return g[b]})}},{key:'request',value:function request(){var b=this,c=[].concat(_toConsumableArray(this.props));return(0,_util.api)(this.apiOptions,this.params()).then(function(d){return b.id?d.query.pages[b.id]:Object.values(d.query.pages)}).then(function(d){return Array.isArray(d)?d.map(function(f){return process(c,f)}):process(c,d)})}},{key:'chain',value:function chain(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return b&&this.props.add(b),Object.assign(this._params,c),this}},{key:'geosearch',value:function geosearch(b,c,d){return this.chain(void 0,{generator:'geosearch',ggsradius:d,ggscoord:b+'|'+c})}},{key:'search',value:function search(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:50;return this.chain(void 0,{list:'search',srsearch:b,srlimit:c})}},{key:'content',value:function content(){return this.chain('extracts',{explaintext:'1'})}},{key:'summary',value:function summary(){return this.chain('extracts',{explaintext:'1',exintro:'1'})}},{key:'image',value:function image(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{thumbnail:!0,original:!1,name:!0};return this.chain('pageimages',{piprop:Object.keys(b).filter(function(c){return b[c]}).join('|')})}},{key:'extlinks',value:function extlinks(){return this.chain('extlinks',{ellimit:'max'})}},{key:'links',value:function links(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100;return this.chain('links',{plnamespace:0,pllimit:b})}},{key:'categories',value:function categories(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100;return this.chain('categories',{pllimit:b})}},{key:'coordinates',value:function coordinates(){return this.chain('coordinates')}},{key:'langlinks',value:function langlinks(){return this.chain('langlinks',{lllimit:'max',llprop:'url'})}}]),a}();exports.default=QueryChain;
//# sourceMappingURL=chain.js.map